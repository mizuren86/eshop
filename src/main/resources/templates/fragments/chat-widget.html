<div th:fragment="chatWidget">
    <style>
        .chat-icon {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: #28a745;
            color: white;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 9999;
        }

        .chat-container {
            position: fixed;
            bottom: 100px;
            left: 20px;
            width: 450px;
            background: white;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 9999;
            border: 1px solid #28a745;
        }

        .chat-header {
            background: #28a745;
            color: white;
            padding: 15px;
            text-align: center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-size: 18px;
        }

		.quick-actions-wrapper {
		    display: flex;
		    align-items: center;
		    overflow: hidden;
		    position: relative;
		    background: #f8f9fa;
		    padding: 10px;
		    border-bottom: 1px solid #eee;
		}

		.quick-actions {
		    display: flex;
		    gap: 10px;
		    overflow-x: auto;
		    scroll-behavior: smooth;
		    white-space: nowrap;
		    flex-grow: 1;
		    padding-bottom: 5px;
		}

		.quick-actions::-webkit-scrollbar {
		    display: none; /* éš±è—æ»¾å‹•æ¢ */
		}

		.quick-btn {
		    padding: 8px 15px;
		    background: #28a745;
		    color: white;
		    border: none;
		    border-radius: 20px;
		    cursor: pointer;
		    transition: all 0.3s;
		    display: flex;
		    align-items: center;
		    gap: 5px;
		    font-size: 14px;
		    flex-shrink: 0;
		}

		.quick-btn:hover {
		    background: #218838;
		    transform: translateY(-2px);
		    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
		}

		.scroll-btn {
		    background: #ddd;
		    border: none;
		    padding: 8px 12px;
		    font-size: 18px;
		    cursor: pointer;
		    border-radius: 5px;
		    transition: background 0.3s;
		}

		.scroll-btn:hover {
		    background: #bbb;
		}

        .chat-box {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .message {
            padding: 12px;
            border-radius: 10px;
            margin: 5px 0;
            max-width: 85%;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .user-message {
            background: rgb(192, 192, 192);
            color: white;
            align-self: flex-end;
        }

        .bot-message {
            background: #e6f7e1;
            color: black;
            align-self: flex-start;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
            background: #f8f9fa;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .chat-input button {
            padding: 10px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }

        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
			
			min-width: 30px !important;
			flex-shrink: 0; /* æ–°å¢é˜²æ­¢ç¼©æ”¾ */
			   
			
        }

        .user-avatar {
            background-color: #28a745;
        }

        .bot-avatar {
            background-color: #218838;
        }

        .timestamp {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>

    <!-- å¼•å…¥ Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- å®¢æœåœ–æ¨™ -->
    <div class="chat-icon" onclick="toggleChatWindow()">ğŸ’¬</div>

    <!-- èŠå¤©çª—å£ -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <strong>å®¢æœå°è©±</strong>
            <button class="btn-close btn-close-white float-end" onclick="toggleChatWindow()"></button>
        </div>

        <!-- å¿«é€Ÿæ“ä½œæŒ‰éˆ• -->
		<!-- å¿«é€Ÿæ“ä½œå€åŸŸ -->
		    <div class="quick-actions-wrapper">
		        <button class="scroll-btn left" onclick="scrollQuickActions(-150)">&#10094;</button>
		        <div class="quick-actions">
		            <button class="quick-btn" onclick="handleQuickAction('orders')">
		                <i class="fas fa-box"></i>æˆ‘çš„è¨‚å–®
		            </button>
		            <button class="quick-btn" onclick="handleQuickAction('faq')">
		                <i class="fas fa-question-circle"></i>ç†±é–€å•é¡Œ
		            </button>
		            <button class="quick-btn" onclick="handleQuickAction('promotions')">
		                <i class="fas fa-gift"></i>æœ€æ–°æ´»å‹•
		            </button>
		            <button class="quick-btn" onclick="handleQuickAction('customer-service')">
		                <i class="fas fa-headset"></i>äººå·¥å®¢æœ
		            </button>
		        </div>
		        <button class="scroll-btn right" onclick="scrollQuickActions(150)">&#10095;</button>
		    </div>

        <!-- èŠå¤©å…§å®¹ -->
        <div class="chat-box" id="chatBox">
            <div th:each="message : ${chatHistory}">
                <div class="message user-message">
                    <div class="avatar user-avatar"><i class="fas fa-user"></i></div>
                    <div>
                        <div th:text="${message.userMessage}"></div>
                        <div class="timestamp" th:text="${message.timestamp}"></div>
                    </div>
                </div>
                <div class="message bot-message">
                    <div class="avatar bot-avatar"><i class="fas fa-robot"></i></div>
                    <div>
                        <div th:text="${message.botResponse}"></div>
                        <div class="timestamp" th:text="${message.timestamp}"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¼¸å…¥è¡¨å–® -->
        <form id="chatForm" class="chat-input">
            <input type="text" id="message" placeholder="è¼¸å…¥è¨Šæ¯..." required class="form-control">
            <button type="submit" class="btn btn-primary">å‚³é€</button>
        </form>
    </div>

    <script>
        // åˆ‡æ›èŠå¤©è¦–çª—
        function toggleChatWindow() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.style.display = (chatContainer.style.display === 'none' || chatContainer.style.display === '') 
                ? 'block' 
                : 'none';
        }

        // å¿«é€ŸæŒ‰éˆ•
		function handleQuickAction(type) {
		    const messages = {
		        orders: 'æ‚¨çš„æœ€æ–°è¨‚å–®ç‹€æ…‹å¦‚ä¸‹ï¼š\nè¨‚å–®ç·¨è™Ÿï¼š#123456\nç‹€æ…‹ï¼šå·²å‡ºè²¨ ğŸšš',
		        faq: 'å¸¸è¦‹å•é¡Œï¼š\n1. å¦‚ä½•é€€è²¨ï¼Ÿ\n2. æœƒå“¡é»æ•¸å¦‚ä½•ä½¿ç”¨ï¼Ÿ\n3. å¦‚ä½•ä¿®æ”¹è¨‚å–®è³‡è¨Šï¼Ÿ',
		        promotions: 'æœ€æ–°æ´»å‹•ï¼š\nğŸ”¥ é€±å¹´æ…¶å…¨é¤¨ 8 æŠ˜ï¼\nğŸ æ¶ˆè²»æ»¿ 1000 å…ƒé€ 100 å…ƒè³¼ç‰©é‡‘ï¼'
		    };

		    if(messages[type]) {
		        displayMessage(messages[type], 'bot');
		    }
		}

        // è¡¨å–®æäº¤è™•ç†
        document.getElementById("chatForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const userMessage = document.getElementById("message").value.trim();
            
            if(userMessage) {
                displayMessage(userMessage, "user");
                document.getElementById("message").value = "";
                sendMessage(userMessage);
            }
        });

        // é¡¯ç¤ºè¨Šæ¯
        function displayMessage(message, sender) {
            const chatBox = document.getElementById("chatBox");
            const messageDiv = document.createElement("div");
            messageDiv.className = `message ${sender}-message`;

            // å»ºç«‹é ­åƒ
            const avatar = document.createElement("div");
            avatar.className = `avatar ${sender}-avatar`;
            avatar.innerHTML = `<i class="fas ${sender === 'user' ? 'fa-user' : 'fa-robot'}"></i>`;

            // è¨Šæ¯å…§å®¹
            const content = document.createElement("div");
            const text = document.createElement("div");
            text.textContent = message;

            // æ™‚é–“æˆ³è¨˜
            const timestamp = document.createElement("div");
            timestamp.className = "timestamp";
            timestamp.textContent = new Date().toLocaleTimeString();

            // çµ„åˆå…ƒç´ 
            content.appendChild(text);
            content.appendChild(timestamp);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatBox.appendChild(messageDiv);

            // è‡ªå‹•æ»¾å‹•
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // ç™¼é€è¨Šæ¯åˆ°å¾Œç«¯
        function sendMessage(message) {
            fetch('/chat/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message }),
            })
            .then(response => response.json())
            .then(data => {
                if(data.botResponse) {
                    displayMessage(data.botResponse, "bot");
                }
            })
            .catch(error => console.error('Error:', error));
        }
		
		
		
		//æ»¾å‹•
		function scrollQuickActions(amount) {
		    const quickActions = document.querySelector(".quick-actions");
		    quickActions.scrollBy({ left: amount, behavior: "smooth" });
		}

		
    </script>
</div>