<!DOCTYPE html>
<html lang="en" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/base}">
<head>
  <meta charset="utf-8">
  <title>Login - Fruitables</title>
</head>
<body>
  <!-- 將此區塊作為 base.html 中 layout:fragment="content" 的替換內容 -->
  <div layout:fragment="content">
    <div class="container py-5">
      <h1 class="mb-4">Login</h1>
      <form id="loginForm">
        <div class="mb-3">
          <label for="username" class="form-label">Username</label>
          <input type="text" class="form-control" id="username" name="username" placeholder="Enter username">
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" name="password" placeholder="Enter password">
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
      </form>
      <p class="mt-3">Don't have an account? <a th:href="@{/register}">Register here</a></p>
    </div>
  </div>

  
  
  
    
  <!-- 使用 fetch API 呼叫 REST API /api/users/login -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault(); // 防止表單預設提交
      var username = document.getElementById('username').value;
      var password = document.getElementById('password').value;
      
      fetch(/*[[${'/api/users/login'}]]*/ '/api/users/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,
          password: password
        })
      })
      .then(response => {
        if (!response.ok) {
          // 若非 2xx，嘗試取得錯誤訊息
          return response.text().then(text => { throw new Error(text) });
        }
        return response.json();
      })
      .then(data => {
        console.log("Login successful:", data);
        window.location.href = '/';
      })
      .catch(error => {
        console.error("Login failed:", error);
        alert("Login failed: " + error.message);
      });
    });
    /*]]>*/
  </script>
</body>
</html>
