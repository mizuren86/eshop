<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8" />
	<title>CMS Orders - Fruitables</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="keywords" />
	<meta content="" name="description" />

	<!-- Google Web Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
		rel="stylesheet">

	<!-- Icon Font Stylesheet -->
	<link rel="stylesheet" th:href="@{'https://use.fontawesome.com/releases/v5.15.4/css/all.css'}" />
	<link th:href="@{'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css'}" rel="stylesheet">

	<!-- Libraries Stylesheet -->
	<link th:href="@{/lib/lightbox/css/lightbox.min.css}" rel="stylesheet" />
	<link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet" />

	<!-- Customized Bootstrap Stylesheet -->
	<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />

	<!-- Template Stylesheet -->
	<link th:href="@{/css/style.css}" rel="stylesheet" />

	<!-- SweetAlert2 CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

	<style>
		/* placeholder 樣式 */
		#orderId::placeholder,
		#merchantTradeNo::placeholder {
			color: lightgray;
		}

		/* 編輯按鈕樣式 */
		.btn-custom-white {
			background-color: #E0E0E0;
			color: #000000;
			border: 1px solid #000000;
			border-radius: 8px;
		}

		/* 編輯按鈕當滑鼠移上去時 hover 效果 */
		.btn-custom-white:hover {
			background-color: #f0f0f0;
		}

		/* 下拉選單樣式 */
		.default-option {
			color: lightgray;
		}
	</style>
</head>

<body>
	<!-- Navbar Start -->
	<div class="container-fluid fixed-top">
		<div class="container topbar bg-primary d-none d-lg-block">
			<div class="d-flex justify-content-between">
				<div class="top-info ps-2">
					<small class="me-3" id="userLocation" style="display: none;">
						<i class="fas fa-map-marker-alt me-2 text-secondary"></i> <span id="locationText"
							class="text-white"></span>
					</small>
				</div>
				<div class="top-link pe-2">
					<a class="text-white"><small class="text-white mx-2">CMS - Fruitables</small></a>
				</div>
			</div>
		</div>
		<div class="container px-0">
			<nav class="navbar navbar-light bg-white navbar-expand-xl">
				<a th:href="@{/admin-orders}" class="navbar-brand">
					<h1 class="text-primary display-6">Fruitables</h1>
				</a>
				<button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse"
					data-bs-target="#navbarCollapse">
					<span class="fa fa-bars text-primary"></span>
				</button>
				<div class="collapse navbar-collapse bg-white" id="navbarCollapse">
					<div class="navbar-nav mx-auto">
						<a th:href="@{/admin-users}" class="nav-item nav-link">會員管理</a>
						<a th:href="@{/admin-products}" class="nav-item nav-link">商品管理</a>
						<a th:href="@{/admin-orders}" class="nav-item nav-link">訂單管理</a>
						<a th:href="@{/admin-reviews}" class="nav-item nav-link">評論管理</a>
						<a th:href="@{/admin-reports}" class="nav-item nav-link">報表</a>
					</div>
				</div>
			</nav>
		</div>
	</div>
	<!-- Navbar End -->

	<!-- 頁首 -->
	<header class="container-fluid page-header py-5">
		<h1 class="text-center text-white display-6">訂單管理</h1>
	</header>

	<main class="container py-5">

		<!-- 搜尋功能 -->
		<div class="card bg-light mb-4">
			<div class="card-body">
				<h3 class="card-title text-center">搜尋訂單</h3>
				<br>
				<form th:action="@{/admin-orders}" method="get" class="row g-3 align-items-end" id="searchForm">
					<!-- 訂單編號搜尋 -->
					<div class="col-md">
						<label for="orderId" class="form-label ">訂單編號</label>
						<input type="text" name="orderId" id="orderId" class="form-control" placeholder="訂單編號"
							th:value="${orderId}">
					</div>
					<!-- 交易編號搜尋 -->
					<div class="col-md">
						<label for="merchantTradeNo" class="form-label">交易編號</label>
						<input type="text" name="merchantTradeNo" id="merchantTradeNo" class="form-control"
							placeholder="交易編號" th:value="${merchantTradeNo}">
					</div>
					<!-- 付款狀態搜尋 -->
					<div class="col-md">
						<label for="paymentStatus" class="form-label">付款狀態</label>
						<select name="paymentStatus" id="paymentStatus" class="form-select">
							<option value="" class="default-option">付款狀態</option>
							<option value="待處理" th:selected="${paymentStatus == '待處理'}">待處理</option>
							<option value="已付款" th:selected="${paymentStatus == '已付款'}">已付款</option>
							<option value="失敗" th:selected="${paymentStatus == '失敗'}">失敗</option>
							<option value="已退款" th:selected="${paymentStatus == '已退款'}">已退款</option>
						</select>
					</div>
					<!-- 配送狀態搜尋 -->
					<div class="col-md">
						<label for="shippingStatus" class="form-label">配送狀態</label>
						<select name="shippingStatus" id="shippingStatus" class="form-select">
							<option value="" class="default-option">配送狀態</option>
							<option value="處理中" th:selected="${shippingStatus == '處理中'}">處理中</option>
							<option value="已出貨" th:selected="${shippingStatus == '已出貨'}">已出貨</option>
							<option value="已送達" th:selected="${shippingStatus == '已送達'}">已送達</option>
							<option value="已取消" th:selected="${shippingStatus == '已取消'}">已取消</option>
						</select>
					</div>
					<!-- 按鈕 -->
					<div class="col-auto">
						<button type="submit" class="btn btn-primary me-2">搜尋</button>
						<button type="button" class="btn btn-secondary" id="clearSearch">清除</button>
					</div>
				</form>
			</div>
		</div>

		<!-- 如果沒有訂單，顯示提示訊息 -->
		<div th:if="${#lists.isEmpty(ordersPage.content)}">
			<p class="text-center">沒有訂單</p>
		</div>

		<!-- 訂單管理列表 -->
		<div th:unless="${#lists.isEmpty(ordersPage.content)}">
			<table class="order-table table">
				<thead>
					<tr>
						<th class="text-center align-middle">訂單編號</th>
						<th class="text-center align-middle">交易編號</th>
						<th class="text-center align-middle">顧客姓名</th>
						<th class="text-center align-middle">訂單金額</th>
						<th class="text-center align-middle">付款狀態</th>
						<th class="text-center align-middle">配送狀態</th>
						<th class="text-center align-middle">訂單日期</th>
						<th class="text-center align-middle">編輯訂單</th>
						<th class="text-center align-middle">刪除訂單</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="order : ${ordersPage.content}"
						th:attr="data-order-id=${order.orderId}, data-shipping-status=${order.shippingStatus}">
						<td class="text-center align-middle" th:text="${order.orderId}">訂單編號</td>
						<td class="text-center align-middle">
							<a href="#" th:onclick="'showOrderDetails(' + ${order.orderId} + '); return false;'"
								th:text="${order.merchantTradeNo}">交易編號</a>
						</td>
						<td class="text-center align-middle" th:text="${order.users.username}">顧客姓名</td>
						<td class="text-center align-middle"
							th:text="${'$' + #numbers.formatDecimal(order.totalAmount, 0, 0)}">$0</td>
						<td class="text-center align-middle" th:text="${order.paymentStatus}">付款狀態</td>
						<td class="text-center align-middle shippingStatus">
							<a href="#" th:data-shipping-method="${order.shippingMethod}"
								th:data-shipping-address="${order.shippingAddress}"
								th:data-recipient-name="${order.recipientName}"
								th:data-recipient-phone="${order.recipientPhone}"
								th:data-order-remark="${order.orderRemark}"
								onclick="showShippingDetails(this); return false;"
								th:text="${order.shippingStatus}">配送狀態</a>
						</td>
						<td class="text-center align-middle"
							th:text="${#temporals.format(order.orderDate, 'yyyy/MM/dd HH:mm:ss')}">訂單日期</td>
						<td class="text-center align-middle">
							<button type="button" class="btn btn-custom-white action-btn" onclick="editOrder(this);">
								編輯
							</button>
						</td>
						<td class="text-center align-middle delete-button-cell">
							<!-- 當 order 不為 null 並且付款狀態等於 '待處理' 且配送狀態等於 '處理中' 時，顯示可點擊的刪除按鈕 -->
							<button type="button" class="btn btn-danger action-btn"
								th:if="${order != null and order.paymentStatus.name() == '待處理' and order.shippingStatus.name() == '處理中'}"
								th:onclick="'deleteOrder(' + ${order.orderId} + ')'">
								<i class="fa fa-trash"></i>
							</button>
							<!-- 否則顯示禁用的灰色按鈕 -->
							<button type="button" class="btn btn-secondary action-btn"
								th:if="${order == null or not (order.paymentStatus.name() == '待處理' and order.shippingStatus.name() == '處理中')}"
								style="background-color: #D0D0D0; border-color: #6c757d;" disabled>
								<i class="fa fa-trash"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- 分頁 -->
		<div class="pagination d-flex justify-content-center mt-5" th:if="${not #lists.isEmpty(ordersPage.content)}">
			<!-- 上一頁 -->
			<a th:if="${ordersPage.number > 0}" th:href="@{'/admin-orders'(page=${ordersPage.number - 1})}"
				class="rounded">&laquo;</a>

			<!-- 頁碼 -->
			<a th:each="i : ${#numbers.sequence(0, ordersPage.totalPages - 1)}" th:href="@{'/admin-orders'(page=${i})}"
				th:text="${i + 1}" th:classappend="${i == ordersPage.number} ? ' active rounded' : ' rounded'"></a>

			<!-- 下一頁 -->
			<a th:if="${ordersPage.number < ordersPage.totalPages - 1}"
				th:href="@{'/admin-orders'(page=${ordersPage.number + 1})}" class="rounded">&raquo;</a>
		</div>
	</main>

	<!-- Footer Start -->
	<div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5">
		<div class="container py-5">
			<div class="pb-4 mb-4" style="border-bottom: 1px solid rgba(226, 175, 24, 0.5)">
				<div class="row g-4">
					<div class="col-lg-3">
						<a href="#">
							<h1 class="text-primary mb-0">Fruitables</h1>
							<p class="text-secondary mb-0">Fresh products</p>
						</a>
					</div>
				</div>
			</div>
			<div class="row g-5">

			</div>
		</div>
	</div>
	<!-- Footer End -->

	<!-- Copyright Start -->
	<div class="container-fluid copyright bg-dark py-4">
		<div class="container">
			<div class="row">
				<span class="text-light text-md-center"> <a href="#"> <i
							class="fas fa-copyright text-light me-2"></i>Fruitables
					</a>, All right reserved.
				</span>
			</div>
		</div>
	</div>
	<!-- Copyright End -->

	<!-- Back to Top -->
	<a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top">
		<i class="fa fa-arrow-up"></i>
	</a>

	<!-- JavaScript Libraries -->
	<script th:src="@{'https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js'}"></script>
	<script th:src="@{'https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js'}"></script>
	<script th:src="@{/lib/easing/easing.min.js}"></script>
	<script th:src="@{/lib/waypoints/waypoints.min.js}"></script>
	<script th:src="@{/lib/lightbox/js/lightbox.min.js}"></script>
	<script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>
	<script th:src="@{'https://cdn.jsdelivr.net/npm/sweetalert2@11'}"></script>
	<!-- Template Javascript -->
	<script th:src="@{/js/main.js}"></script>
	<script>
		// 訂單狀態編輯，並更新後端資料
		/*		function editOrder(buttonElement) {
					// 取得所在表格的 <tr>
					const row = buttonElement.closest('tr');
		
					// 從 data 屬性中取出 orderId、付款狀態與配送狀態
					const orderId = row.getAttribute('data-order-id');
					const currentShippingStatus = row.getAttribute('data-shipping-status');
		
					Swal.fire({
						icon: 'warning',
						title: '編輯訂單狀態',
						html:
							'<form id="editForm" class="text-start">' +
							'  <div class="mb-3">' +
							'    <label for="swal-shippingStatus" class="form-label"><strong>配送狀態</strong></label>' +
							'    <select id="swal-shippingStatus" class="form-select">' +
							'      <option value="處理中">處理中</option>' +
							'      <option value="已出貨">已出貨</option>' +
							'      <option value="已送達">已送達</option>' +
							'      <option value="已取消">已取消</option>' +
							'    </select>' +
							'  </div>' +
							'</form>',
						showCancelButton: true,
						confirmButtonText: '儲存變更',
						cancelButtonText: '取消',
						preConfirm: () => {
							const shippingStatus = document.getElementById('swal-shippingStatus').value;
							if (!shippingStatus) {
								Swal.showValidationMessage('請選擇所有狀態');
							}
							return {shippingStatus: shippingStatus};
						},
						didOpen: () => {
							// 預設選取目前狀態
							document.getElementById('swal-shippingStatus').value = currentShippingStatus;
						},
						customClass: {
							confirmButton: 'btn btn-primary me-3',
							cancelButton: 'btn btn-secondary'
						},
						buttonsStyling: false,
						width: '600px'
					}).then((result) => {
						if (result.isConfirmed) {
							const data = result.value;
							fetch('/admin-orders/updateAjax/' + orderId, {
								method: 'POST',
								headers: {'Content-Type': 'application/json'},
								body: JSON.stringify(data)
							})
								.then(response => {
									if (!response.ok) {
										throw new Error(response.statusText);
									}
									return response.json();
								})
								.then(updated => {
									// 更新表格中該筆訂單的配送狀態顯示
									const shippingStatusCell = row.querySelector('.shippingStatus a');
									if (shippingStatusCell) {
										shippingStatusCell.textContent = updated.shippingStatus;
									}
									// 同步更新 data 屬性供未來再次編輯時使用
									row.setAttribute('data-shipping-status', updated.shippingStatus);
		
									// 取得付款狀態：付款狀態所在的 td 為第 5 個
									const paymentStatusTd = row.querySelector("td:nth-child(5)");
									const currentPaymentStatus = paymentStatusTd ? paymentStatusTd.textContent.trim() : '';
		
									// 更新刪除按鈕：條件是：付款狀態為 "待處理" 且配送狀態為 "處理中"
									const deleteCell = row.querySelector('.delete-button-cell');
									if (deleteCell) {
										if (currentPaymentStatus === "待處理" && updated.shippingStatus === "處理中") {
											// 建立一個可點擊的紅色垃圾桶按鈕
											deleteCell.innerHTML = `<button type="button" class="btn btn-danger action-btn" onclick="deleteOrder(${orderId})">
													<i class="fa fa-trash"></i>
												</button>`;
										} else {
											// 建立一個禁用的灰色垃圾桶按鈕
											deleteCell.innerHTML = `<button type="button" class="btn btn-secondary action-btn" style="background-color: #D0D0D0; border-color: #6c757d;" disabled>
													<i class="fa fa-trash"></i>
												</button>`;
										}
									}
		
									Swal.fire({
										icon: 'success',
										title: '更新成功',
										text: '配送狀態已更新',
										timer: 1500,
										showConfirmButton: false
									});
								})
								.catch(error => {
									console.error('更新訂單時發生錯誤：', error);
									Swal.fire({
										icon: 'error',
										title: '更新失敗',
										text: '請稍後再試。'
									});
								});
						}
					});
				}
				
				
				
				*/	



		function editOrder(buttonElement) {
			// 取得所屬表格的 <tr> 並取出 orderId 與目前配送狀態
			const row = buttonElement.closest('tr');
			const orderId = row.getAttribute('data-order-id');
			const currentShippingStatus = row.getAttribute('data-shipping-status');

			// 先從後端取得該訂單的所有訂單項目資料
			fetch('/admin-orders/orderDetails/' + orderId)
				.then(response => {
					if (!response.ok) {
						throw new Error('無法取得訂單商品資料');
					}
					return response.json();
				})
				.then(items => {
					// 產生訂單項目編輯表格 HTML
					let tableHTML = '<table class="table table-bordered" id="orderItemsTable">';
					tableHTML += '<thead><tr>';
					tableHTML += '<th>商品圖片</th><th>商品名稱</th><th>數量</th><th>刪除商品</th>';
					tableHTML += '</tr></thead><tbody>';
					items.forEach(item => {
						// 確保 imageUrl 為正確格式（若未以 "/" 開頭則補上）
						let imageUrl = item.imageUrl;
						if (imageUrl && !imageUrl.startsWith('/')) {
							imageUrl = '/' + imageUrl;
						}
						tableHTML += '<tr data-product-id="' + item.productId + '">';
						tableHTML += '<td><img src="' + imageUrl + '" alt="商品圖片" style="width:50px; height:50px;"></td>';
						tableHTML += '<td>' + item.productName + '</td>';
						// 建立數量輸入框（type="number"、最小值=1）
						tableHTML += '<td><input type="number" class="form-control product-qty" value="' + item.quantity + '" min="1" style="width:80px;"></td>';
						// 操作欄位：刪除按鈕
						tableHTML += '<td><button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItemRow(this)">刪除</button></td>';
						tableHTML += '</tr>';
					});
					tableHTML += '</tbody></table>';

					// 建立編輯表單，包含配送狀態下拉選單與訂單項目編輯表格
					const formHTML =
						'<form id="editOrderForm" class="text-start">' +
						'  <div class="mb-3">' +
						'    <label for="swal-shippingStatus" class="form-label"><strong>配送狀態</strong></label>' +
						'    <select id="swal-shippingStatus" class="form-select">' +
						'      <option value="處理中">處理中</option>' +
						'      <option value="已出貨">已出貨</option>' +
						'      <option value="已送達">已送達</option>' +
						'      <option value="已取消">已取消</option>' +
						'    </select>' +
						'  </div>' +
						'  <div class="mb-3">' +
						'    <label class="form-label"><strong>訂單商品</strong></label>' +
						tableHTML +
						'  </div>' +
						'</form>';

					// 開啟 SweetAlert2 彈窗編輯訂單
					Swal.fire({
						icon: 'warning',
						title: '編輯訂單',
						html: formHTML,
						showCancelButton: true,
						confirmButtonText: '儲存變更',
						cancelButtonText: '取消',
						preConfirm: () => {
							// 取得更新後的配送狀態
							const shippingStatus = document.getElementById('swal-shippingStatus').value;
							if (!shippingStatus) {
								Swal.showValidationMessage('請選擇配送狀態');
							}
							// 收集表格中每一行的數量資料
							const rows = document.querySelectorAll('#orderItemsTable tbody tr');
							let itemsData = [];
							rows.forEach(row => {
								const productId = row.getAttribute('data-product-id');
								const qtyInput = row.querySelector('.product-qty');
								if (qtyInput) {
									let quantity = parseInt(qtyInput.value, 10);
									if (isNaN(quantity) || quantity < 1) quantity = 1;
									itemsData.push({productId: productId, quantity: quantity});
								}
							});
							return {shippingStatus: shippingStatus, items: itemsData};
						},
						didOpen: () => {
							// 設定預設配送狀態
							document.getElementById('swal-shippingStatus').value = currentShippingStatus;
						},
						customClass: {
							confirmButton: 'btn btn-primary me-3',
							cancelButton: 'btn btn-secondary'
						},
						buttonsStyling: false,
						width: '600px'
					}).then((result) => {
						if (result.isConfirmed) {
							const data = result.value;
							// 送出更新請求，請求的 API URL 請依照後端實作調整
							fetch('/admin-orders/updateOrderItems/' + orderId, {
								method: 'POST',
								headers: {'Content-Type': 'application/json'},
								body: JSON.stringify(data)
							})
								.then(response => {
									if (!response.ok) {
										throw new Error(response.statusText);
									}
									return response.json();
								})
								.then(updated => {
									// 更新成功後更新該列的配送狀態顯示（若後端回傳 updated.shippingStatus）
									const shippingStatusCell = row.querySelector('.shippingStatus a');
									if (shippingStatusCell) {
										shippingStatusCell.textContent = updated.shippingStatus;
									}
									row.setAttribute('data-shipping-status', updated.shippingStatus);
									Swal.fire({
										icon: 'success',
										title: '更新成功',
										text: '訂單已更新',
										timer: 1500,
										showConfirmButton: false,
										width: '600px',
										customClass: {
											confirmButton: 'btn btn-primary me-3'
										},
										buttonsStyling: false
									});
								})
								.catch(error => {
									console.error('更新訂單時發生錯誤：', error);
									Swal.fire({
										icon: 'error',
										title: '更新失敗',
										text: '請稍後再試。',
										width: '600px',
										customClass: {
											confirmButton: 'btn btn-primary me-3'
										},
										buttonsStyling: false
									});
								});
						}
					});
				})
				.catch(error => {
					console.error('取得訂單項目資料錯誤：', error);
					Swal.fire({
						icon: 'error',
						title: '錯誤',
						text: error.message,
						width: '600px',
						customClass: {
							confirmButton: 'btn btn-primary me-3'
						},
						buttonsStyling: false
					});
				});
		}

		// 刪除訂單項目列的函式
		function removeOrderItemRow(btn) {
			const row = btn.closest('tr');
			row.parentNode.removeChild(row);
		}


	

		










		// 刪除訂單
		function deleteOrder(orderId) {
			Swal.fire({
				icon: 'warning',
				title: '確認刪除',
				text: '你確定要刪除此筆訂單嗎？此操作無法恢復。',
				showCancelButton: true,
				confirmButtonText: '刪除',
				cancelButtonText: '取消',
				customClass: {
					confirmButton: 'btn btn-danger me-3',
					cancelButton: 'btn btn-secondary'
				},
				buttonsStyling: false
			}).then((result) => {
				if (result.isConfirmed) {
					fetch('/admin-orders/delete/' + orderId, {method: 'DELETE'})
						.then(response => {
							if (response.ok) {
								Swal.fire({
									icon: 'success',
									title: '已刪除',
									text: '訂單已成功刪除。',
									timer: 1500,
									showConfirmButton: false
								}).then(() => {window.location.reload();});
							} else {
								Swal.fire({
									icon: 'error',
									title: '刪除失敗',
									text: '無法刪除此筆訂單，請稍後再試。'
								});
							}
						})
						.catch(error => {
							console.error('刪除訂單時發生錯誤：', error);
							Swal.fire({
								icon: 'error',
								title: '刪除失敗',
								text: '無法刪除此筆訂單，請稍後再試。'
							});
						});
				}
			});
		}

		// 配送詳情
		function showShippingDetails(anchorElement) {
			// 讀取 data- 屬性中的配送詳細資訊
			var shippingMethod = anchorElement.getAttribute('data-shipping-method') || '無';
			var shippingAddress = anchorElement.getAttribute('data-shipping-address') || '無';
			var recipientName = anchorElement.getAttribute('data-recipient-name') || '無';
			var recipientPhone = anchorElement.getAttribute('data-recipient-phone') || '無';
			var orderRemark = anchorElement.getAttribute('data-order-remark') || '無';

			// 組合要顯示的 HTML 內容
			var htmlContent =
				'<div class="shipping-details" style="text-align: left;">' +
				'<p><strong>配送方式：</strong><br>' + shippingMethod + '</p>' +
				'<p><strong>配送地址：</strong><br>' + shippingAddress + '</p>' +
				'<p><strong>收件人姓名：</strong><br>' + recipientName + '</p>' +
				'<p><strong>收件人電話：</strong><br>' + recipientPhone + '</p>' +
				'<p><strong>訂單備註：</strong><br>' + orderRemark + '</p>' +
				'</div>';

			Swal.fire({
				icon: "info",
				title: '配送詳情',
				width: '600px',
				html: htmlContent,
				confirmButtonText: '確定',
				customClass: {
					confirmButton: 'btn border-secondary rounded px-4 py-3 text-primary text-uppercase'
				},
				buttonsStyling: false
			});
		}

		// 搜尋選項清除
		window.addEventListener("DOMContentLoaded", function () {
			var clearBtn = document.getElementById("clearSearch");
			var searchForm = document.getElementById("searchForm");
			if (clearBtn && searchForm) {
				clearBtn.addEventListener("click", function () {
					// 取得表單內所有 input 與 select 元素，手動清空它們的值
					var inputs = searchForm.querySelectorAll("input, select");
					inputs.forEach(function (input) {
						// 清空 input 的值
						input.value = "";
					});
					// 提交表單
					searchForm.submit();
				});
			}
		});

		// 訂單詳情
		function showOrderDetails(orderId) {
			fetch('/admin-orders/orderDetails/' + orderId)
				.then(response => {
					if (!response.ok) {
						throw new Error('無法取得訂單明細');
					}
					return response.json();
				})
				.then(data => {
					// data 預期是一個訂單明細的陣列，例如：[{productImage: '/img/products/xxx.jpg', productName: '商品名稱', quantity: 2}, ...]
					if (!data || data.length === 0) {
						Swal.fire({
							icon: 'error',
							title: '訂單明細',
							text: '此訂單無明細資料',
							width: '600px',
							customClass: {
								confirmButton: 'btn btn-primary me-3'
							},
							buttonsStyling: false
						});
						return;
					}
					let html = '<table class="table table-bordered"><thead><tr>';
					html += '<th></th><th>商品名稱</th><th>購買數量</th>';
					html += '</tr></thead><tbody>';
					data.forEach(item => {
						html += '<tr>';
						html += '<td><img src="' + item.imageUrl + '" alt="商品圖片" style="width:50px; height:50px;"></td>';
						html += '<td>' + item.productName + '</td>';
						html += '<td>' + item.quantity + '</td>';
						html += '</tr>';
					});
					html += '</tbody></table>';
					Swal.fire({
						icon: 'info',
						title: '訂單明細',
						html: html,
						width: '600px',
						confirmButtonText: '關閉',
						customClass: {
							confirmButton: 'btn btn-primary me-3'
						},
						buttonsStyling: false
					});
				})
				.catch(error => {
					console.error('取得訂單明細錯誤：', error);
					Swal.fire({
						icon: 'error',
						title: '錯誤',
						text: error.message,
						width: '600px',
						customClass: {
							confirmButton: 'btn btn-primary me-3'
						},
						buttonsStyling: false
					});
				});
		}
	</script>
</body>

</html>