<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/base}">

<head>
	<meta charset="utf-8" />
	<title>Orders - Fruitables</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" rel="stylesheet">

	<style>
		/* 基本容器與標題 */
		.container {
			max-width: 1200px;
			margin: auto;
		}

		h2 {
			margin-bottom: 1rem;
		}

		/* 訂單區塊：圓角與黃色邊框 */
		.order-block {
			margin-bottom: 2rem;
			padding: 1rem;
			border: 1px solid #ffc107;
			/* 黃色邊框 */
			border-radius: 8px;
			background-color: #fff;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
		}

		.order-summary p {
			margin: 0.5rem 0;
		}

		/* 表格樣式：使用 separate 並設定圓角與黃色邊框 */
		.order-table {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
			margin-top: 1rem;
			border-radius: 8px;
			overflow: hidden;
		}

		.order-table th,
		.order-table td {
			border: 1px solid #ffc107;
			/* 黃色邊框 */
			padding: 0.75rem;
			text-align: center;
		}

		.order-table thead {
			background-color: #f8f9fa;
		}

		/* 分頁樣式 */
		.pagination {
			margin-top: 20px;
			text-align: center;
		}

		.pagination ul {
			list-style-type: none;
			padding: 0;
			display: inline-block;
		}

		.pagination li {
			display: inline;
			margin: 0 5px;
		}

		.pagination li a,
		.pagination li span {
			display: inline-block;
			padding: 5px 10px;
			border: 1px solid #ffc107;
			/* 使用黃色 */
			text-decoration: none;
			color: #333;
		}

		.pagination li.active span {
			background-color: #ffc107;
			color: #fff;
			border-color: #ffc107;
		}
	</style>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			console.log("DOMContentLoaded triggered, clearing localStorage...");
			localStorage.clear();
			console.log("localStorage after clear:", localStorage);
		});
	</script>
</head>

<body>
	<div layout:fragment="content">
		<!-- 頁首 -->
		<header class="container-fluid page-header py-5">
			<h1 class="text-center text-white display-6">Orders</h1>
			<nav aria-label="breadcrumb" class="breadcrumb justify-content-center">
				<a th:href="@{/index}" class="breadcrumb-item">Home</a>
				<span class="breadcrumb-item active text-white">Orders</span>
			</nav>
		</header>

		<!-- 訂單列表 -->
		<main class="container py-5">
			<h2 class="text-center">我的訂單</h2>
			<!-- 若無訂單資料則顯示提示 -->
			<div th:if="${#lists.isEmpty(ordersPage.content)}">
				<p class="text-center">目前沒有訂單。</p>
			</div>
			<!-- 遍歷每筆訂單 -->
			<div th:each="order : ${ordersPage.content}">
				<div class="order-block">
					<h4>
						訂單編號：
						<span th:text="${order.merchantTradeNo}">編號</span>
					</h4>
					<p>訂單成立時間：
						<span th:text="${#temporals.format(order.orderDate, 'yyyy/MM/dd HH:mm:ss')}">時間</span>
					</p>
					<p>付款狀態：<span th:text="${order.paymentStatus}">狀態</span></p>
					<p>配送狀態：<span th:text="${order.shipmentStatus}">狀態</span></p>

					<!-- 訂單項目表格 -->
					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th></th>
									<th class="text-center align-middle">品名</th>
									<th class="text-center align-middle">單價</th>
									<th class="text-center align-middle">數量</th>
									<th class="text-center align-middle">小計</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="item : ${order.orderItems}">
									<td class="text-center align-middle">
										<img th:src="@{${item.imageUrl}}" alt="商品圖片" class="img-fluid rounded-circle"
											style="width:80px; height:80px;">
									</td>
									<td class="text-center align-middle" th:text="${item.productName}">品名</td>
									<td class="text-center align-middle"
										th:text="${'$' + #numbers.formatDecimal(item.price, 0, 0)}">單價</td>
									<td class="text-center align-middle" th:text="${item.quantity}">數量</td>
									<td class="text-center align-middle"
										th:text="${'$' + #numbers.formatDecimal(item.subTotal, 0, 0)}">小計</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- 訂單摘要 -->

					<div class="order-summary p-3">
						<div class="mb-2">
							<span style="width: 90%; display: inline-block; text-align: right; padding-right: 20px;">
								<strong>運費：</strong>
							</span>
							<span
								th:text="${order.shippingFee != null ? '$' + #numbers.formatDecimal(order.shippingFee, 0, 0) : '無'}"></span>
						</div>
						<div class="mb-2" th:if="${order.couponDiscount > 0}">
							<span style="width: 90%; display: inline-block; text-align: right; padding-right: 20px;">
								<strong>折扣：</strong>
							</span>
							<span
								th:text="${order.couponDiscount != null && order.couponDiscount > 0 ? '-$' + #numbers.formatDecimal(order.couponDiscount, 0, 0) : '無'}"></span>
						</div>
						<div>
							<span style="width: 90%; display: inline-block; text-align: right; padding-right: 20px;">
								<strong>合計：</strong>
							</span>
							<span
								th:text="${order.totalAmount != null ? '$' + #numbers.formatDecimal(order.totalAmount, 0, 0) : '無'}"></span>
						</div>
					</div>



				</div>
				<hr>
			</div>

			<!-- 分頁 -->
			<div class="pagination d-flex justify-content-center mt-5">
				<!-- 上一頁 -->
				<a th:if="${ordersPage.number > 0}" th:href="@{'/orders'(page=${ordersPage.number - 1})}"
					class="rounded">&laquo;</a>

				<!-- 頁碼 -->
				<a th:each="i : ${#numbers.sequence(0, ordersPage.totalPages - 1)}" th:href="@{'/orders'(page=${i})}"
					th:text="${i + 1}" th:classappend="${i == ordersPage.number} ? 'active rounded' : 'rounded'"></a>

				<!-- 下一頁 -->
				<a th:if="${ordersPage.number < ordersPage.totalPages - 1}"
					th:href="@{'/orders'(page=${ordersPage.number + 1})}" class="rounded">&raquo;</a>
			</div>
		</main>
	</div>
</body>

</html>