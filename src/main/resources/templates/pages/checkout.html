<!DOCTYPE html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/base}"
>
    <head>
        <meta charset="utf-8" />
        <title>Checkout - Fruitables</title>
        <style>
            .hidden {
                display: none !important;
            }
            .checkout-block {
                border: 1px solid #ccc;
                padding: 1rem;
                margin-bottom: 1rem;
            }
            .shipping-note {
                margin-top: 1rem;
                font-size: 0.9rem;
                color: #555;
            }
        </style>
    </head>
    <body>
        <!-- 將此區塊作為 base.html 中 layout:fragment="content" 的替換內容 -->
        <div layout:fragment="content">
            <!-- Single Page Header Start -->
            <div class="container-fluid page-header py-5">
                <h1 class="text-center text-white display-6">Checkout</h1>
                <ol class="breadcrumb justify-content-center mb-0">
                    <li class="breadcrumb-item"><a th:href="@{/index}">Home</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/pages}">Pages</a></li>
                    <li class="breadcrumb-item active text-white">Checkout</li>
                </ol>
            </div>
            <!-- Single Page Header End -->

            <!-- Checkout Page Start -->
            <div class="container py-5" id="checkoutPage">
                <h3>結帳資料</h3>

                <!-- 各結帳區塊 -->
                <div id="checkout-711-cod" class="checkout-block hidden">
                    <h5>7-11 取貨付款 + 7-11 取貨付款（付現取貨） 結帳</h5>
                    <!-- 此區塊內容根據第一張圖 -->
                    <p>請填寫7-11取貨付款相關資訊。</p>
                </div>
                <div id="checkout-711-no-cod-jkos" class="checkout-block hidden">
                    <h5>7-11 取貨不付款 + 街口支付 結帳</h5>
                    <p>請填寫7-11取貨不付款及街口支付相關資訊。</p>
                </div>
                <div id="checkout-711-no-cod-linepay" class="checkout-block hidden">
                    <h5>7-11 取貨不付款 + LINE Pay 結帳</h5>
                    <p>請填寫7-11取貨不付款及LINE Pay相關資訊。</p>
                </div>
                <div id="checkout-711-no-cod-credit" class="checkout-block hidden">
                    <h5>7-11 取貨不付款 + 信用卡 結帳</h5>
                    <p>請填寫7-11取貨不付款及信用卡相關資訊。</p>
                </div>
                <div id="checkout-hct-jkos" class="checkout-block hidden">
                    <h5>新竹貨運 + 街口支付 結帳</h5>
                    <p>請填寫新竹貨運及街口支付相關資訊。</p>
                </div>
                <div id="checkout-hct-linepay" class="checkout-block hidden">
                    <h5>新竹貨運 + LINE Pay 結帳</h5>
                    <p>請填寫新竹貨運及LINE Pay相關資訊。</p>
                </div>
                <div id="checkout-hct-credit" class="checkout-block hidden">
                    <h5>新竹貨運 + 信用卡 結帳</h5>
                    <p>請填寫新竹貨運及信用卡相關資訊。</p>
                </div>
                <div id="checkout-outer-island-jkos" class="checkout-block hidden">
                    <h5>外島郵寄 + 街口支付 結帳</h5>
                    <p>請填寫外島郵寄及街口支付相關資訊。</p>
                </div>
                <div id="checkout-outer-island-linepay" class="checkout-block hidden">
                    <h5>外島郵寄 + LINE Pay 結帳</h5>
                    <p>請填寫外島郵寄及LINE Pay相關資訊。</p>
                </div>
                <div id="checkout-outer-island-credit" class="checkout-block hidden">
                    <h5>外島郵寄 + 信用卡 結帳</h5>
                    <p>請填寫外島郵寄及信用卡相關資訊。</p>
                </div>

                <!-- 運費提示，當選擇新竹貨運或外島郵寄時顯示 -->
                <div id="shippingFeeNote" class="shipping-note hidden">
                    運費將於填寫送貨地址後，於結帳頁顯示。
                </div>

                <!-- 訂單合計區域，若顯示則顯示合計 -->
                <div id="orderSummary" class="d-flex justify-content-between mb-3 hidden">
                    <span>合計：</span>
                    <span id="grandTotal">$0</span>
                </div>

                <button id="backToCart" class="btn btn-secondary mt-3">返回購物車</button>
            </div>
            <!-- Checkout Page End -->

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    // 從 localStorage 取得使用者在 cart.html 選擇的送貨與付款方式
                    const shippingMethod = localStorage.getItem("selectedShippingMethod");
                    const paymentMethod = localStorage.getItem("selectedPaymentMethod");

                    // 組合規則：
                    //  - 若送貨方式為 "711-cod"，則顯示 "checkout-711-cod"
                    //  - 若送貨方式為 "711-no-cod"，則依付款方式組成 ID，如 "checkout-711-no-cod-jkos"、"checkout-711-no-cod-linepay"、"checkout-711-no-cod-credit"
                    //  - 若送貨方式為 "hct"，則 ID 為 "checkout-hct-" + 付款方式
                    //  - 若送貨方式為 "outer-island"，則 ID 為 "checkout-outer-island-" + 付款方式
                    let targetBlockId = "";
                    if (shippingMethod === "711-cod") {
                        targetBlockId = "checkout-711-cod";
                    } else if (shippingMethod === "711-no-cod") {
                        targetBlockId = "checkout-711-no-cod-" + paymentMethod;
                    } else if (shippingMethod === "hct") {
                        targetBlockId = "checkout-hct-" + paymentMethod;
                    } else if (shippingMethod === "outer-island") {
                        targetBlockId = "checkout-outer-island-" + paymentMethod;
                    } else {
                        targetBlockId = "checkout-711-cod";
                    }

                    // 隱藏所有結帳區塊
                    const checkoutBlocks = document.querySelectorAll(".checkout-block");
                    checkoutBlocks.forEach((block) => block.classList.add("hidden"));

                    // 根據送貨方式決定是否顯示運費與合計區域
                    // 假設：若送貨方式為 7-11（711-cod 或 711-no-cod），則運費固定 60；若為新竹或外島，則隱藏運費與合計，顯示提示訊息
                    const shippingFeeNote = document.getElementById("shippingFeeNote");
                    const orderSummary = document.getElementById("orderSummary");
                    const fixedShippingFee = 60;
                    let cartSubtotal = 500; // 假設購物車小記為 500

                    if (shippingMethod === "711-cod" || shippingMethod === "711-no-cod") {
                        // 顯示運費與合計
                        document.getElementById("grandTotal").textContent =
                            "$" + (cartSubtotal + fixedShippingFee - 300); // 優惠固定 300
                        orderSummary.classList.remove("hidden");
                        shippingFeeNote.classList.add("hidden");
                    } else if (shippingMethod === "hct" || shippingMethod === "outer-island") {
                        // 隱藏運費與合計區域，顯示提示訊息
                        orderSummary.classList.add("hidden");
                        shippingFeeNote.classList.remove("hidden");
                    } else {
                        orderSummary.classList.remove("hidden");
                        shippingFeeNote.classList.add("hidden");
                    }

                    // 顯示目標結帳區塊
                    const targetBlock = document.getElementById(targetBlockId);
                    if (targetBlock) {
                        targetBlock.classList.remove("hidden");
                    } else {
                        // 若找不到，預設顯示 7-11 取貨付款區塊
                        document.getElementById("checkout-711-cod").classList.remove("hidden");
                    }

                    // 返回購物車按鈕
                    document.getElementById("backToCart").addEventListener("click", function () {
                        window.location.href = "cart.html";
                    });
                });
            </script>
        </div>
    </body>
</html>
