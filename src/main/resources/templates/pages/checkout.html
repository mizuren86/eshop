<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/base}">

<head>
	<meta charset="utf-8" />
	<title>Checkout - Fruitables</title>
	<style>
		.hidden {
			display: none !important;
		}

		.checkout-block {
			border: 1px solid #ccc;
			padding: 1rem;
			margin-bottom: 1rem;
		}

		.shipping-note {
			margin-top: 1rem;
			font-size: 0.9rem;
			color: #555;
		}

		/* placeholder 樣式 */
		#customerPhone::placeholder,
		#recipientPhone::placeholder {
			color: lightgray;
		}

		#customerPhone::-webkit-input-placeholder,
		#recipientPhone::-webkit-input-placeholder {
			color: lightgray;
		}

		#customerPhone:-ms-input-placeholder,
		#recipientPhone:-ms-input-placeholder {
			color: lightgray;
		}

		table tfoot td {
			border: none;
		}
	</style>
</head>

<body>
	<div layout:fragment="content">
		<!-- Header -->
		<div class="container-fluid page-header py-5">
			<h1 class="text-center text-white display-6">Checkout</h1>
			<ol class="breadcrumb justify-content-center mb-0">
				<li class="breadcrumb-item"><a th:href="@{/index}">Home</a></li>
				<li class="breadcrumb-item"><a th:href="@{/cart}">Cart</a></li>
				<li class="breadcrumb-item active text-white">Checkout</li>
			</ol>
		</div>



		<!-- Checkout Page -->
		<div class="container py-5" id="checkoutPage">

			<!-- 購物車清單 -->
			<section class="cart-table-section card p-4 mb-4">
				<h4 class="mb-3">購物車</h4>
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
								<th class="text-center"></th>
								<th class="text-center">品名</th>
								<th class="text-center">價格</th>
								<th class="text-center">數量</th>
								<th class="text-center">小計</th>
							</tr>
						</thead>
						<tbody id="cartItems">
							<!-- 由 fetchCartData() 動態生成 -->
						</tbody>
						<tfoot>
							<tr>
								<td colspan="3"></td>
								<td class="text-end align-middle"><strong>小計：</strong></td>
								<td id="subtotalAmount" class="text-center align-middle"><strong>$0</strong></td>
							</tr>
							<tr>
								<td colspan="3"></td>
								<td class="text-end align-middle"><strong>運費：</strong></td>
								<td id="shippingFee" class="text-center align-middle"><strong>$0</strong></td>
							</tr>
							<!-- 優惠券折扣列，預設隱藏，由 JS 控制顯示 -->
							<tr id="couponDiscountRow" style="display: none;">
								<td colspan="3"></td>
								<td class="text-end align-middle"><strong>優惠券：</strong></td>
								<td id="couponDiscount" class="text-center align-middle"><strong>-$0</strong></td>
							</tr>
							<tr>
								<td colspan="3"></td>
								<td class="text-end align-middle"><strong>合計：</strong></td>
								<td id="grandTotal" class="text-center align-middle"><strong>$0</strong></td>
							</tr>
						</tfoot>
					</table>
				</div>
			</section>

			<div th:switch="${shippingMethod}">
				<!-- 1) 7-11 取貨付款 (付現取貨) -->
				<div th:case="'711-cod'">
					<div class="row">
						<!-- 左欄：顧客資料與訂單備註 -->
						<div class="col-md-6">
							<div class="card p-3 mb-4">
								<h4 class="mb-3">顧客資料</h4>
								<div class="mb-3">
									<label for="customerName" class="form-label">顧客名稱</label>
									<input type="text" class="form-control" id="customerName" name="customerName"
										placeholder="" th:value="${users.username}" />
								</div>
								<div class="mb-3">
									<label for="customerEmail" class="form-label">電子信箱</label>
									<input type="email" class="form-control" id="customerEmail" name="customerEmail"
										placeholder="" th:value="${users.email}" />
									<div class="form-text mt-2">
										請填入訂單通知Email (訂單資訊將以此E-mail通知您)
									</div>
								</div>
								<div class="mb-3">
									<label for="customerPhone" class="form-label">電話號碼</label>
									<input type="text" class="form-control" id="customerPhone" name="customerPhone"
										placeholder="0912 345 678" th:value="${users.phone}" />
								</div>
							</div>
							<div class="card p-3">
								<h4 class="mb-3">訂單備註</h4>
								<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
									placeholder="有什麼想告訴賣家嗎"></textarea>
							</div>
						</div>
						<!-- 右欄：送貨資料與付款資料 -->
						<div class="col-md-6">
							<div class="card p-3 mb-4">
								<div class="d-flex justify-content-between align-items-center mb-3">
									<h4 class="mb-0">送貨資料</h4>
									<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
								</div>
								<p class="mb-1">
									已選擇的送貨方式: 7-11 取貨付款（寄出日系統會發電子郵件通知，
									一般寄出日+2日會抵達門市）<br />
								</p>
								<div class="mb-3 mt-2">
									<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
									<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
								</div>
								<div class="mb-3 mt-3">
									<label for="recipientName" class="form-label">收件人姓名</label>
									<input type="text" class="form-control" id="recipientName" name="recipientName"
										placeholder="" />
									<div class="form-text mt-2">
										請填入收件人真實姓名，以確保順利收件
									</div>
								</div>
								<div class="mb-3">
									<label for="recipientPhone" class="form-label">收件人電話號碼</label>
									<input type="text" class="form-control" id="recipientPhone" name="recipientPhone"
										placeholder="0912 345 678" />
								</div>
								<button type="button" class="btn btn-outline-secondary">選擇門市</button>
							</div>
							<div class="card p-3">
								<div class="d-flex justify-content-between align-items-center mb-3">
									<h4 class="mb-0">付款資料</h4>
									<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
								</div>
								<p class="m-0">
									已選擇的付款方式: 7-11 取貨付款（包裹抵達指定門市後，付現取貨）
								</p>
							</div>
						</div>
					</div>
				</div>

				<!-- 2) 7-11 取貨不付款 -->
				<div th:case="'711-no-cod'">
					<div th:switch="${paymentMethod}">
						<!-- 2-1) 7-11 取貨不付款 + LINE PAY -->
						<div th:case="'linepay'">
							<div class="row">
								<!-- 左欄：顧客資料與訂單備註 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<h4 class="mb-3">顧客資料</h4>
										<div class="mb-3">
											<label for="customerName" class="form-label">顧客名稱</label>
											<input type="text" class="form-control" id="customerName"
												name="customerName" placeholder="" th:value="${users.username}" />
										</div>
										<div class="mb-3">
											<label for="customerEmail" class="form-label">電子信箱</label>
											<input type="email" class="form-control" id="customerEmail"
												name="customerEmail" placeholder="" th:value="${users.email}" />
											<div class="form-text mt-2">
												請填入訂單通知Email (訂單資訊將以此E-mail通知您)
											</div>
										</div>
										<div class="mb-3">
											<label for="customerPhone" class="form-label">電話號碼</label>
											<input type="text" class="form-control" id="customerPhone"
												name="customerPhone" placeholder="0912 345 678"
												th:value="${users.phone}" />
										</div>
									</div>
									<div class="card p-3">
										<h4 class="mb-3">訂單備註</h4>
										<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
											placeholder="有什麼想告訴賣家嗎"></textarea>
									</div>
								</div>
								<!-- 右欄：送貨資料與付款資料 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">送貨資料</h4>
											<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
										</div>
										<p class="mb-1">
											已選擇的送貨方式: 7-11 取貨不付款（寄出日系統會發電子郵件通知，
											一般寄出日+2日會抵達門市）<br />
										</p>
										<div class="mb-3 mt-2">
											<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
											<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
										</div>
										<div class="mb-3 mt-3">
											<label for="recipientName" class="form-label">收件人姓名</label>
											<input type="text" class="form-control" id="recipientName"
												name="recipientName" placeholder="" />
											<div class="form-text mt-2">
												請填入收件人真實姓名，以確保順利收件
											</div>
										</div>
										<div class="mb-3">
											<label for="recipientPhone" class="form-label">收件人電話號碼</label>
											<input type="text" class="form-control" id="recipientPhone"
												name="recipientPhone" placeholder="0912 345 678" />
										</div>
										<button type="button" class="btn btn-outline-secondary">選擇門市</button>
									</div>
									<div class="card p-3">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">付款資料</h4>
											<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
										</div>
										<!-- 固定顯示 LINE Pay -->
										<p class="m-0">已選擇的付款方式: LINE Pay</p>
									</div>
								</div>
							</div>
						</div>
						<!-- 2-2) 7-11 取貨不付款 + 信用卡 -->
						<div th:case="'credit'">
							<div class="row">
								<!-- 左欄：顧客資料與訂單備註 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<h4 class="mb-3">顧客資料</h4>
										<div class="mb-3">
											<label for="customerName" class="form-label">顧客名稱</label>
											<input type="text" class="form-control" id="customerName"
												name="customerName" placeholder="" th:value="${users.username}" />
										</div>
										<div class="mb-3">
											<label for="customerEmail" class="form-label">電子信箱</label>
											<input type="email" class="form-control" id="customerEmail"
												name="customerEmail" placeholder="" th:value="${users.email}" />
											<div class="form-text mt-2">
												請填入訂單通知Email (訂單資訊將以此E-mail通知您)
											</div>
										</div>
										<div class="mb-3">
											<label for="customerPhone" class="form-label">電話號碼</label>
											<input type="text" class="form-control" id="customerPhone"
												name="customerPhone" placeholder="0912 345 678"
												th:value="${users.phone}" />
										</div>
									</div>
									<div class="card p-3">
										<h4 class="mb-3">訂單備註</h4>
										<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
											placeholder="有什麼想告訴賣家嗎"></textarea>
									</div>
								</div>
								<!-- 右欄：送貨資料與付款資料 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">送貨資料</h4>
											<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
										</div>
										<p class="mb-1">
											已選擇的送貨方式: 7-11 取貨不付款（寄出日系統會發電子郵件通知，
											一般寄出日+2日會抵達門市）<br />
										</p>
										<div class="mb-3 mt-2">
											<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
											<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
										</div>
										<div class="mb-3 mt-3">
											<label for="recipientName" class="form-label">收件人姓名</label>
											<input type="text" class="form-control" id="recipientName"
												name="recipientName" placeholder="" />
											<div class="form-text mt-2">
												請填入收件人真實姓名，以確保順利收件
											</div>
										</div>
										<div class="mb-3">
											<label for="recipientPhone" class="form-label">收件人電話號碼</label>
											<input type="text" class="form-control" id="recipientPhone"
												name="recipientPhone" placeholder="0912 345 678" />
										</div>
										<button type="button" class="btn btn-outline-secondary">選擇門市</button>
									</div>
									<div class="card p-3">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">付款資料</h4>
											<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
										</div>
										<!-- 固定顯示信用卡 -->
										<p class="m-0">已選擇的付款方式: 信用卡</p>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
				<!-- 3) 新竹貨運 -->
				<div th:case="'hct'">
					<div th:switch="${paymentMethod}">
						<!-- 3-1) 新竹貨運 + LINE PAY -->
						<div th:case="'linepay'">
							<div class="row">
								<!-- 左欄：顧客資料與訂單備註 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<h4 class="mb-3">顧客資料</h4>
										<div class="mb-3">
											<label for="customerName" class="form-label">顧客名稱</label>
											<input type="text" class="form-control" id="customerName"
												name="customerName" placeholder="" th:value="${users.username}" />
										</div>
										<div class="mb-3">
											<label for="customerEmail" class="form-label">電子信箱</label>
											<input type="email" class="form-control" id="customerEmail"
												name="customerEmail" placeholder="" th:value="${users.email}" />
											<div class="form-text mt-2">
												請填入訂單通知Email (訂單資訊將以此E-mail通知您)
											</div>
										</div>
										<div class="mb-3">
											<label for="customerPhone" class="form-label">電話號碼</label>
											<input type="text" class="form-control" id="customerPhone"
												name="customerPhone" placeholder="0912 345 678"
												th:value="${users.phone}" />
										</div>
									</div>
									<div class="card p-3">
										<h4 class="mb-3">訂單備註</h4>
										<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
											placeholder="有什麼想告訴賣家嗎"></textarea>
									</div>
								</div>
								<!-- 右欄：送貨資料與付款資料 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<!-- 新竹貨運區塊中新增送貨地址 -->
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">送貨資料</h4>
											<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
										</div>
										<p class="mb-1">
											已選擇的送貨方式: 新竹貨運（請填寫送貨地址）<br />
										</p>
										<div class="mb-3">
											<label for="shippingAddress" class="form-label">送貨地址</label>
											<input type="text" class="form-control" id="shippingAddress"
												name="shippingAddress" placeholder="請輸入詳細送貨地址" />
										</div>
										<div class="mb-3 mt-2">
											<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
											<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
										</div>
										<div class="mb-3 mt-3">
											<label for="recipientName" class="form-label">收件人姓名</label>
											<input type="text" class="form-control" id="recipientName"
												name="recipientName" placeholder="" />
											<div class="form-text mt-2">
												請填入收件人真實姓名，以確保順利收件
											</div>
										</div>
										<div class="mb-3">
											<label for="recipientPhone" class="form-label">收件人電話號碼</label>
											<input type="text" class="form-control" id="recipientPhone"
												name="recipientPhone" placeholder="0912 345 678" />
										</div>
										<button type="button" class="btn btn-outline-secondary">選擇門市</button>
									</div>
									<div class="card p-3">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">付款資料</h4>
											<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
										</div>
										<p class="m-0">已選擇的付款方式: LINE PAY</p>
									</div>
								</div>
							</div>
						</div>
						<!-- 3-2) 新竹貨運 + 信用卡 -->
						<div th:case="'credit'">
							<div class="row">
								<!-- 左欄：顧客資料與訂單備註 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<h4 class="mb-3">顧客資料</h4>
										<div class="mb-3">
											<label for="customerName" class="form-label">顧客名稱</label>
											<input type="text" class="form-control" id="customerName"
												name="customerName" placeholder="" th:value="${users.username}" />
										</div>
										<div class="mb-3">
											<label for="customerEmail" class="form-label">電子信箱</label>
											<input type="email" class="form-control" id="customerEmail"
												name="customerEmail" placeholder="" th:value="${users.email}" />
											<div class="form-text mt-2">
												請填入訂單通知Email (訂單資訊將以此E-mail通知您)
											</div>
										</div>
										<div class="mb-3">
											<label for="customerPhone" class="form-label">電話號碼</label>
											<input type="text" class="form-control" id="customerPhone"
												name="customerPhone" placeholder="0912 345 678"
												th:value="${users.phone}" />
										</div>
									</div>
									<div class="card p-3">
										<h4 class="mb-3">訂單備註</h4>
										<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
											placeholder="有什麼想告訴賣家嗎"></textarea>
									</div>
								</div>
								<!-- 右欄：送貨資料與付款資料 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<!-- 新增「送貨地址」欄位 -->
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">送貨資料</h4>
											<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
										</div>
										<p class="mb-1">
											已選擇的送貨方式: 新竹貨運（請填寫送貨地址）<br />
										</p>
										<div class="mb-3">
											<label for="shippingAddress" class="form-label">送貨地址</label>
											<input type="text" class="form-control" id="shippingAddress"
												name="shippingAddress" placeholder="請輸入詳細送貨地址" />
										</div>
										<div class="mb-3 mt-2">
											<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
											<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
										</div>
										<div class="mb-3 mt-3">
											<label for="recipientName" class="form-label">收件人姓名</label>
											<input type="text" class="form-control" id="recipientName"
												name="recipientName" placeholder="" />
											<div class="form-text mt-2">
												請填入收件人真實姓名，以確保順利收件
											</div>
										</div>
										<div class="mb-3">
											<label for="recipientPhone" class="form-label">收件人電話號碼</label>
											<input type="text" class="form-control" id="recipientPhone"
												name="recipientPhone" placeholder="0912 345 678" />
										</div>
										<button type="button" class="btn btn-outline-secondary">選擇門市</button>
									</div>
									<div class="card p-3">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">付款資料</h4>
											<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
										</div>
										<p class="m-0">已選擇的付款方式: 信用卡</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- outer-island 區塊 -->
				<div th:case="'outer-island'">
					<div th:switch="${paymentMethod}">
						<!-- 外島郵寄 + LINE PAY -->
						<div th:case="'linepay'">
							<div class="row">
								<!-- 左欄：顧客資料與訂單備註 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<h4 class="mb-3">顧客資料</h4>
										<div class="mb-3">
											<label for="customerName" class="form-label">顧客名稱</label>
											<input type="text" class="form-control" id="customerName"
												name="customerName" placeholder="" th:value="${users.username}" />
										</div>
										<div class="mb-3">
											<label for="customerEmail" class="form-label">電子信箱</label>
											<input type="email" class="form-control" id="customerEmail"
												name="customerEmail" placeholder="" th:value="${users.email}" />
											<div class="form-text mt-2">
												請填入訂單通知Email (訂單資訊將以此E-mail通知您)
											</div>
										</div>
										<div class="mb-3">
											<label for="customerPhone" class="form-label">電話號碼</label>
											<input type="text" class="form-control" id="customerPhone"
												name="customerPhone" placeholder="0912 345 678"
												th:value="${users.phone}" />
										</div>
									</div>
									<div class="card p-3">
										<h4 class="mb-3">訂單備註</h4>
										<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
											placeholder="有什麼想告訴賣家嗎"></textarea>
									</div>
								</div>
								<!-- 右欄：送貨資料與付款資料 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">送貨資料</h4>
											<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
										</div>
										<p class="mb-1">
											已選擇的送貨方式: 外島郵寄（請填寫送貨地址）<br />
										</p>
										<div class="mb-3">
											<label for="shippingAddress" class="form-label">送貨地址</label>
											<input type="text" class="form-control" id="shippingAddress"
												name="shippingAddress" placeholder="請輸入詳細送貨地址" />
										</div>
										<div class="mb-3 mt-2">
											<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
											<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
										</div>
										<div class="mb-3 mt-3">
											<label for="recipientName" class="form-label">收件人姓名</label>
											<input type="text" class="form-control" id="recipientName"
												name="recipientName" placeholder="" />
											<div class="form-text mt-2">
												請填入收件人真實姓名，以確保順利收件
											</div>
										</div>
										<div class="mb-3">
											<label for="recipientPhone" class="form-label">收件人電話號碼</label>
											<input type="text" class="form-control" id="recipientPhone"
												name="recipientPhone" placeholder="0912 345 678" />
										</div>
										<button type="button" class="btn btn-outline-secondary">選擇門市</button>
									</div>
									<div class="card p-3">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">付款資料</h4>
											<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
										</div>
										<p class="m-0">已選擇的付款方式: LINE PAY</p>
									</div>
								</div>
							</div>
						</div>
						<!-- 外島郵寄 + 信用卡 -->
						<div th:case="'credit'">
							<div class="row">
								<!-- 左欄：顧客資料與訂單備註 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<h4 class="mb-3">顧客資料</h4>
										<div class="mb-3">
											<label for="customerName" class="form-label">顧客名稱</label>
											<input type="text" class="form-control" id="customerName"
												name="customerName" placeholder="" th:value="${users.username}" />
										</div>
										<div class="mb-3">
											<label for="customerEmail" class="form-label">電子信箱</label>
											<input type="email" class="form-control" id="customerEmail"
												name="customerEmail" placeholder="" th:value="${users.email}" />
											<div class="form-text mt-2">
												請填入訂單通知Email (訂單資訊將以此E-mail通知您)
											</div>
										</div>
										<div class="mb-3">
											<label for="customerPhone" class="form-label">電話號碼</label>
											<input type="text" class="form-control" id="customerPhone"
												name="customerPhone" placeholder="0912 345 678"
												th:value="${users.phone}" />
										</div>
									</div>
									<div class="card p-3">
										<h4 class="mb-3">訂單備註</h4>
										<textarea id="orderRemark" name="orderRemark" class="form-control" rows="3"
											placeholder="有什麼想告訴賣家嗎"></textarea>
									</div>
								</div>
								<!-- 右欄：送貨資料與付款資料 -->
								<div class="col-md-6">
									<div class="card p-3 mb-4">
										<!-- 新增「送貨地址」欄位 -->
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">送貨資料</h4>
											<p id="shippingFeeText" class="mb-0">運費 NT$60</p>
										</div>
										<p class="mb-1">
											已選擇的送貨方式: 外島郵寄（請填寫送貨地址）<br />
										</p>
										<div class="mb-3">
											<label for="shippingAddress" class="form-label">送貨地址</label>
											<input type="text" class="form-control" id="shippingAddress"
												name="shippingAddress" placeholder="請輸入詳細送貨地址" />
										</div>
										<div class="mb-3 mt-2">
											<input type="checkbox" id="sameAsCustomer" name="sameAsCustomer" />
											<label for="sameAsCustomer">收件人資料與顧客資料相同</label>
										</div>
										<div class="mb-3 mt-3">
											<label for="recipientName" class="form-label">收件人姓名</label>
											<input type="text" class="form-control" id="recipientName"
												name="recipientName" placeholder="" />
											<div class="form-text mt-2">
												請填入收件人真實姓名，以確保順利收件
											</div>
										</div>
										<div class="mb-3">
											<label for="recipientPhone" class="form-label">收件人電話號碼</label>
											<input type="text" class="form-control" id="recipientPhone"
												name="recipientPhone" placeholder="0912 345 678" />
										</div>
										<button type="button" class="btn btn-outline-secondary">選擇門市</button>
									</div>
									<div class="card p-3">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h4 class="mb-0">付款資料</h4>
											<p class="mb-0">合計: <span id="paymentGrandTotal">$0</span></p>
										</div>
										<p class="m-0">已選擇的付款方式: 信用卡</p>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>


				<!-- 下方按鈕 -->
				<div style="display: flex; justify-content: space-between" class="mt-4">
					<button id="backToCart"
						class="btn border-secondary rounded-pill px-4 py-3 text-primary text-uppercase">
						返回購物車
					</button>
					<button id="submitOrder"
						class="btn border-secondary rounded-pill px-4 py-3 text-primary text-uppercase">
						提交訂單
					</button>
				</div>
			</div>
			<!-- Checkout Page End -->

			<script th:inline="javascript">
				/*<![CDATA[*/
				var cartSubtotal = /*[[${totalAmount}]]*/ 0;

				// 運費 60
				var fixedShippingFee = 60;

				// 全域變數：保存購物車小記
				let currentSubtotal = 0;

				// 重新計算小記
				function recalcSubtotal(cartItems) {
					return cartItems.reduce((sum, item) => sum + item.subTotal, 0);
				}

				// 讀取 Session 中的 couponDiscount //
				var sessionCouponDiscount = /*[[${couponDiscount != null ? couponDiscount : 0}]]*/ 0;

				// 全域變數
				var couponDiscountOverall = sessionCouponDiscount;

				document.addEventListener("DOMContentLoaded", () => {
					initCountryOptions();
					onCountryChange();
					// 更新優惠券折扣和總計
					updateGrandTotal();
				});

				// 更新總計 //
				function updateGrandTotal() {
					// 從小計欄位讀取當前小計
					const currentSubtotal = parseInt(document.getElementById("subtotalAmount").textContent.replace("$", "")) || 0;
					// 從送貨資訊抓取運費
					const shippingFee = updateShippingFeeFromShippingInfo();
					const grandTotalValue = currentSubtotal + shippingFee - couponDiscountOverall;
					document.getElementById("grandTotal").textContent = "$" + grandTotalValue;
					document.getElementById("paymentGrandTotal").textContent = "$" + grandTotalValue;

					// 控制優惠券行的顯示：當折扣大於 0 時顯示，否則隱藏
					const couponRow = document.getElementById("couponDiscountRow");
					if (couponDiscountOverall > 0) {
						couponRow.style.display = "table-row";  // 對於 <tr> 元素使用 table-row
						document.getElementById("couponDiscount").textContent = "-$" + couponDiscountOverall;
					} else {
						couponRow.style.display = "none";
					}
				}

				// 重新載入購物車資料 //
				document.addEventListener("DOMContentLoaded", fetchCartData);
				
				function updateShippingFeeFromShippingInfo() {
					// 讀取運費文字，例如 "運費 NT$60"
					const feeText = document.getElementById("shippingFeeText").textContent;
					// 用正則表達式找出數字部分
					const match = feeText.match(/\d+/);
					const feeValue = match ? parseInt(match[0], 10) : 0;
					// 更新表尾中運費的內容
					document.getElementById("shippingFee").textContent = "$" + feeValue;
					// 回傳數字方便更新合計
					return feeValue;
				}

				async function fetchCartData() {
					try {
						const response = await fetch("/api/cart");
						if (!response.ok) throw new Error("Network response was not ok");
						const {cartItems, totalAmount} = await response.json();
						currentSubtotal = recalcSubtotal(cartItems);
						const cartItemsContainer = document.getElementById("cartItems");
						cartItemsContainer.innerHTML = "";

						cartItems.forEach((item) => {
							// 從 sessionStorage 中讀取用戶在 cart 頁面選定的數量
							const storedQuantity = sessionStorage.getItem("cartItem_" + item.cartItemId);
							if (storedQuantity !== null) {
								item.quantity = parseInt(storedQuantity);
								item.subTotal = item.price * item.quantity;
							}
							const row = document.createElement("tr");
							row.innerHTML = `
				            	<td class="text-center align-middle">
				                	<img src="${item.product.imageUrl}" alt="" class="img-fluid rounded-circle" style="width:80px; height:80px;">
				                </td>
				               	<td class="text-center align-middle">${item.product.productName}</td>
				                <td class="text-center align-middle">$${item.price}</td>
				                <td class="text-center align-middle">
									<div class="d-flex justify-content-center align-items-center mx-auto" style="width:100px;">
										<span id="quantity-${item.cartItemId}" class="text-center">${item.quantity}</span>
									</div>
								</td>
				                <td class="text-center align-middle">$${item.subTotal}</td>
				            `;
							cartItemsContainer.appendChild(row);
						});

						document.getElementById("subtotalAmount").textContent = "$" + currentSubtotal;
						updateGrandTotal();
					} catch (error) {
						console.error("Error fetching cart data:", error);
					}
				}
				/*]]>*/
			</script>

			<!-- 返回購物車、收件人資料複製 -->
			<script>
				document.addEventListener("DOMContentLoaded", function () {
					document.getElementById("backToCart").addEventListener("click", function () {
						window.location.href = "/cart";
					});
					const sameCheckbox = document.getElementById("sameAsCustomer");
					sameCheckbox.addEventListener("change", function () {
						if (this.checked) {
							document.getElementById("recipientName").value =
								document.getElementById("customerName").value;
							document.getElementById("recipientPhone").value =
								document.getElementById("customerPhone").value;
						} else {
							document.getElementById("recipientName").value = "";
							document.getElementById("recipientPhone").value = "";
						}
					});
				});
			</script>
		</div>
</body>

</html>